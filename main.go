// +build ignore

package main

import (
	"fmt"

	. "github.com/barnex/jit"
)

func main() {

	code := []byte{
		0x48, 0x83, 0xec, 0x08, //              sub    $0x8,%rsp
		0x0f, 0x57, 0xc0, //                    xorps  %xmm0,%xmm0
		0xf2, 0x0f, 0x11, 0x44, 0x24, 0x18, //  movsd  %xmm0,0x18(%rsp)
		0xf2, 0x0f, 0x10, 0x44, 0x24, 0x10, //  movsd  0x10(%rsp),%xmm0
		0xf2, 0x0f, 0x10, 0x44, 0x24, 0x10, //  movsd  0x10(%rsp),%xmm0
		0xf2, 0x0f, 0x11, 0x04, 0x24, //        movsd  %xmm0,(%rsp)
		0xf2, 0x0f, 0x10, 0x04, 0x24, //        movsd  (%rsp),%xmm0
		0xf2, 0x0f, 0x11, 0x44, 0x24, 0x10, //  movsd  %xmm0,0x10(%rsp)
		0xf2, 0x0f, 0x10, 0x44, 0x24, 0x10, //  movsd  0x10(%rsp),%xmm0
		0xf2, 0x0f, 0x10, 0x44, 0x24, 0x10, //  movsd  0x10(%rsp),%xmm0
		0xf2, 0x0f, 0x11, 0x44, 0x24, 0x18, //  movsd  %xmm0,0x18(%rsp)
		0x48, 0x83, 0xc4, 0x08, //              add    $0x8,%rsp
		0xc3, //                                retq
		0xcc, //                                int3
	}

	code, err := MakeExecutable(code)
	if err != nil {
		panic(err)
	}

	f := MakeFunc(code)
	fmt.Println(f())
}
